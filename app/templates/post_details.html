{% extends 'base.html' %}
{% block content %}

<a href="/home">Home</a>

<ul class="posts">

    <li class="posts">
        <div>
            <a href="/home/user/{{ post.author.user_id }}">{{ post.author.user_name }}</a>
        </div>
        {{ post.description }} ({{ total_votes }} people have voted on this)
    <form action="/home/post/{{ post.post_id }}/refresh" method="post">

            {% for choice in choices %}

                {% if choice.text_choice and choice.file_name %}
                     <input type="radio" name="vote" value="{{ choice.choice_id }}" class="choice">
                     <div>{{ choice.text_choice }}</div>
                     <div>
                         <img src="https://s3-us-west-2.amazonaws.com/opinionated/{{hash_files[choice]}}" alt="{{ choice.file_name }}" width="300px" height="auto">
                     </div>

                {% elif choice.file_name %}
                     <input type="radio" name="vote" value="{{ choice.choice_id }}" class="choice">
                     <div>
                         <img src="https://s3-us-west-2.amazonaws.com/opinionated/{{hash_files[choice]}}" alt="{{ choice.file_name }}" width="300px" height="auto">
                     </div>
                {% else  %}
                     <input type="radio" name="vote" value="{{ choice.choice_id }}" class="choice">
                     <div>{{ choice.text_choice }}</div>
                {% endif %}

                <div>
                    number of votes: {{ vote_dict[choice] }}
                {% if total_votes != 0 %}
                    percentage: {{ vote_dict[choice]/ total_votes }}
                {% else %}
                   <p>No one has voted yet</p>
                {% endif %}
                </div>
            {% endfor %}


    <input type="submit" value="Vote">
    </form>
    </li>
</ul>

<h3>Comments</h3>
<form action="/home/post/{{post.post_id}}/comment/refresh" method="post" id="comment-submit">
    <textarea rows="4" cols="100" name="new_comment" id="comment-content"></textarea>
    <br>
    <input id="comment-submit-button" type="submit">
</form>

<ul class="comments">
    <!--{% if comments %}-->

        <!--{% for comment in comments %}-->
        <!--<li>-->
            <!--<a href="/home/user/{{ comment.user_id }}">{{ comment.user.user_name }}</a>:-->
            <!--{{ comment.content }}-->
        <!--</li>-->
        <!--{% endfor %}-->

    <div id="comment-list"></div>

    <!--{% else %}-->
        <!--<p>Oops, looks like no one has commented yet</p>-->
    <!--{% endif %}-->

</ul>


<script src="https://code.jquery.com/jquery.js"></script>
<script>
    function handleComments(evt) {
        evt.preventDefault();
        var formInputs = {comment: $("#comment-content").val()};
        $.post('/home/post/{{post.post_id}}/comment/refresh', formInputs, function (result) {
            console.log(result.user_id)
            $('#comment-list').append('<p><a href="/home/user/'+ result.user_id + '">'+ result.user_id + '</a>:'+ result.content + '</p>')
        })
    }
$('#comment-submit').on('submit', handleComments);

</script>

{% endblock %}